function showBar(){if(!$("#notification-bar").is(":visible")){$("#notification-bar").stop().fadeIn("fast")}$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2))}function hideBar(){if($("#notification-bar").is(":visible")){$("#notification-bar").stop().fadeOut("fast")}}function checkLength(e,t){if(e.val().length>t){return true}else{return false}}function checkSC(e){if(e.val()==""){return false}else{return expSC.test(e.val())}}function checkPasswordMatch(e,t){if($(e).val()==$(t).val()&&$(e).val()!=""&&$(t).val()!=""){return true}else{return false}}var expSC=/^[a-zA-Z0-9_]*$/;var username=false;var saving=false;var changes=false;var passwords=false;var timezone=false;$(document).ready(function(){var e=$(".dropdown-login").text();var t=$("#tz").val();$("#email-noti-thread").change(function(){changes=true});$("#email-noti-comment").change(function(){changes=true});$("#tz").change(function(){if($("#tz").val()!=t)timezone=true;else timezone=false});$("#username-change-input").keyup(function(){var t=$(this);var n=$("#username-change-input").val();if(n!=e){if(checkLength(t,3)){if(checkSC(t)){if(!n.match(/\s/g)){t.parent().find(".validation-settings").attr("src","/images/ajax-loader.gif").fadeIn(250);$.post("/php/checkavail.php",{username:n,settings:true},function(e){if(e==1){$("#notification-bar p").html("Username Available.").removeClass("error").addClass("available");t.parent().find(".validation-settings").attr("src","/images/tick-circle_1.png");showBar();username=true}else if(e==0){$("#notification-bar p").html("Username not available.").addClass("error").removeClass("available");t.parent().find(".validation-settings").attr("src","/images/exclamation-red_1.png");showBar();username=false}else{t.parent().find(".validation-settings").fadeOut(250);username=false}})}else{$("#notification-bar p").html("Username cannot contain spaces.").addClass("error").removeClass("available");t.parent().find(".validation-settings").attr("src","/images/exclamation-red_1.png").fadeIn(250);showBar()}}else{t.parent().find(".validation-settings").attr("src","/images/exclamation-red_1.png").fadeIn(250);$("#notification-bar p").html("Username cannot contain special characters.").addClass("error").removeClass("available");showBar()}}else{t.parent().find(".validation-settings").attr("src","/images/exclamation-red_1.png").fadeIn(250);$("#notification-bar p").html("Username must be at least 4 characters.").addClass("error").removeClass("available");showBar()}}else{t.parent().find(".validation-settings").fadeOut(250);hideBar();username=false}}).focusout(function(){hideBar()});$("#pass-change").keyup(function(){var e=$(this);if(!checkLength(e,5)){$(e).parent().find(".validation-settings:eq(0)").attr("src","/images/exclamation-red_1.png").fadeIn(250);passwords=false}else if(!$(this).val().match(/[A-Z]/)){$(e).parent().find(".validation-settings:eq(0)").attr("src","/images/exclamation-red_1.png").fadeIn(250);passwords=false}else if(!$(this).val().match(/[0-9]/)){$(e).parent().find(".validation-settings:eq(0)").attr("src","/images/exclamation-red_1.png").fadeIn(250);passwords=false}else{$(e).parent().find(".validation-settings:eq(0)").attr("src","/images/tick-circle_1.png").fadeIn(250);passwords=true}}).focusout(function(){hideBar()});$("#pass-change2").keyup(function(){var e=$(this);if(checkPasswordMatch($("#pass-change"),$("#pass-change2"))&&checkLength($("#pass-change"),5)){$(e).parent().find(".validation-settings:eq(1)").attr("src","/images/tick-circle_1.png").fadeIn(250);passwords=true}else{$(e).parent().find(".validation-settings:eq(1)").attr("src","/images/exclamation-red_1.png").fadeIn(250);passwords=false}}).focusout(function(){hideBar()});$(".button").click(function(t){if($(this).text()=="Save"){var n=$("#username-change-input").val();var i=$("#pass-current").val();var s=$("#pass-change").val();var o=$("#pass-change2").val();var u=$("#tz").val();var a=$("#email-noti-thread").is(":checked");var f=$("#email-noti-comment").is(":checked");if(username||changes||passwords||timezone){if(!saving){var l=$("#settings-holder").find(".tabs a.active").text();var c;if(l=="Username"&&username)c={user:n,username:e};else if(l=="Email"&&changes)c={threadcheck:a,commentcheck:f,username:e};else if(l=="Password"&&passwords)c={currentpass:i,newpass:s,newpass2:o,username:e};else if(l=="Timezone"&&timezone)c={timezone:u,username:e};else c="none";if(c!="none"){$("#gif-loader-settings").fadeIn("fast");saving=true;$("#notification-bar p").html("Saving...").removeClass("error").addClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast");$.post("/php/settingsajax.php",c,function(t){if(t==1){e=n;$("#notification-bar p").html("Success, username changed. Refreshing page...").removeClass("error").addClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).delay(1e3).queue(function(){location="http://"+window.location.hostname+"/profile/"+n+"#settings"})}else if(t==2){saving=false;$("#notification-bar p").html("Success. Password has been Changed.").removeClass("error").addClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}else if(t==3){saving=false;$("#notification-bar p").html("Success. Email settings changed.").removeClass("error").addClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}else if(t==4){saving=false;$("#notification-bar p").html("Success, timezone changed. Refreshing page...").removeClass("error").addClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).delay(1e3).queue(function(){window.location.reload()})}else if(t==5){saving=false;$("#notification-bar p").html("Current password did not match. Settings not changed.").addClass("error").removeClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}else if(t==0){saving=false;$("#notification-bar p").html("Something went wrong. Please check your entries.").addClass("error").removeClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}else{saving=false;$("#notification-bar p").html("Error. Please contact us with details.").addClass("error").removeClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}if(r){location="http://"+window.location.hostname}$("#gif-loader-settings").fadeOut("fast");if(t!=0){$("#pass-current").val("");$("#pass-change").val("");$("#pass-change2").val("");$("#pass-change").parent().find(".validation-settings:eq(0)").fadeOut(500);$("#pass-change2").parent().find(".validation-settings:eq(1)").fadeOut(500);username=false;passwords=false;changes=false}})}else{$("#notification-bar p").html("No changes detected on this tab.").addClass("error").removeClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}}}else{$("#notification-bar p").html("No changes detected.").addClass("error").removeClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}}else if($(this).val()=="Reset Password"){if(!passwords){t.preventDefault()}}});$("a.red").click(function(){if($(this).text()=="Delete Account"){var e=false;event.preventDefault();var t=confirm("Are you sure you want to delete your Grumble account?\n\n All of your Grumbles, Comments, Replies, and settings data will be PERMANENTALY deleted.");if(t&&!e){e=true;$("#notification-bar p").html("Deleting account...").removeClass("error").addClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(1e3).fadeOut("slow");$.post("/php/settingsajax.php",{action:"Delete"},function(t){if(t==1){$("#notification-bar p").html("Success, account deleted.").removeClass("error").addClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2e3).queue(function(){location="http://"+window.location.hostname})}else{e=false;$("#notification-bar p").html("Error. Please try again.").addClass("error").removeClass("available");$("#notification-bar").css("marginLeft",-($("#notification-bar").width()/2)).fadeIn("fast").delay(2500).fadeOut("slow")}})}}});$("#settings-dropdown").click(function(){$("#settings-holder").css("top","46px");$("#settings-background").stop().fadeIn("normal");$("#dropdown-form").fadeOut(50,function(){$("#dropdown-form").parents("body").find(".login-drop-image").attr("src","/images/arrow.png")});$("#settings-background").click(function(){$("#settings-holder").stop().animate({top:"-500px"},"normal");$("#settings-background").stop().fadeOut("normal")})});$("#pass-forg").keyup(function(){var e=$(this);if(!checkLength(e,5)){$("#notification-bar p").html("Password is not long enough.").addClass("error").removeClass("available");showBar();passwords=false}else if(!$(this).val().match(/[A-Z]/)){$("#notification-bar p").html("Password must contain a capital letter.").addClass("error").removeClass("available");showBar();passwords=false}else if(!$(this).val().match(/[0-9]/)){$("#notification-bar p").html("Password must contain a number.").addClass("error").removeClass("available");showBar();passwords=false}else{$("#notification-bar p").html("Valid password.").removeClass("error").addClass("available");showBar();passwords=true}}).focusout(function(){hideBar()});$("#pass-forg2").keyup(function(){var e=$(this);if(checkPasswordMatch($("#pass-forg"),$("#pass-forg2"))&&checkLength(e,5)){$("#notification-bar p").html("Passwords match.").removeClass("error").addClass("available");showBar();passwords=true}else{$("#notification-bar p").html("Passwords do not match.").addClass("error").removeClass("available");showBar();passwords=false}}).focusout(function(){hideBar()});var n=window.location.href;var r=false;if(n.indexOf("#settings")!=-1){$("#settings-holder").css("top","46px");$("#settings-background").stop().fadeIn("normal");$("#settings-background").click(function(){$("#settings-holder").stop().animate({top:"-500px"},"normal");$("#settings-background").stop().fadeOut("normal")})}})